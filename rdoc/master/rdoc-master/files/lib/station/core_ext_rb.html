<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>File: core_ext.rb</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />

    <script language="JavaScript" type="text/javascript">
    // <![CDATA[

        function toggleSource( id )
        {
          var elem
          var link

          if( document.getElementById )
          {
            elem = document.getElementById( id )
            link = document.getElementById( "l_" + id )
          }
          else if ( document.all )
          {
            elem = eval( "document.all." + id )
            link = eval( "document.all.l_" + id )
          }
          else
            return false;

          if( elem.style.display == "block" )
          {
            elem.style.display = "none"
            link.innerHTML = "show source"
          }
          else
          {
            elem.style.display = "block"
            link.innerHTML = "hide source"
          }
        }

        function openCode( url )
        {
          window.open( url, "SOURCE_CODE", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=480,width=750" ).focus();
        }
      // ]]>
    </script>
  </head>

  <body>
  <table border='0' cellpadding='0' cellspacing='0' width="100%" class='banner'>
  <tr><td>
    <table width="100%" border='0' cellpadding='0' cellspacing='0'><tr>
      <td class="file-title" colspan="2"><span class="file-title-prefix">File</span><br />core_ext.rb</td>
      <td align="right">
        <table border='0' cellspacing="0" cellpadding="2">
          <tr>
            <td>Path:</td>
            <td>lib/station/core_ext.rb
            </td>
          </tr>
          <tr>
            <td>Modified:</td>
            <td>Tue Jan 12 13:04:32 +0100 2010</td>
          </tr>
        </table>
      </td></tr>
    </table>
  </td></tr>
</table><br />
 <!-- banner header -->

  <div id="bodyContent">
      <div id="content">


  <div class="sectiontitle">Required Files</div>
  <ul>
  <li>will_paginate</li>
  <li>rss/1.0</li>
  <li>rss/2.0</li>
  </ul>


  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="#M000005">atom_entry</a></li>
  <li><a href="#M000004">atom_service</a></li>
  <li><a href="#M000002">polymorphic_url_with_container</a></li>
  <li><a href="#M000001">to_class</a></li>
  <li><a href="#M000003">unshift_container</a></li>
  </ul>






<div class="sectiontitle">Public Instance methods</div>
<div class="method">
  <div class="title">
    <a name="M000005"></a><b>atom_entry</b>(record, options = {}) {|ActionView::Helpers::AtomFeedHelper::AtomFeedBuilder.new(xml, self, options)| ...}
  </div>
  <div class="description">
  <p>
Helper function for describing Atom Entry documents. See RFC 5023
</p>
<p>
Default XML namespace is &#8216;<a
href="http://www.w3.org/2005/Atom">www.w3.org/2005/Atom</a>&#8217;,
&#8216;app&#8217; namespace corresponds to &#8216;<a
href="http://www.w3.org/2007/app">www.w3.org/2007/app</a>&#8216;
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000005_source')" id="l_M000005_source">show source</a> ]</p>
  <div id="M000005_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/station/core_ext.rb, line 75</span>
 75:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">atom_entry</span>(<span class="ruby-identifier">record</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
 76:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:schema_date</span>]
 77:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:schema_date</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:schema_date</span>].<span class="ruby-identifier">strftime</span>(<span class="ruby-value str">&quot;%Y-%m-%d&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:schema_date</span>].<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:strftime</span>)
 78:       <span class="ruby-keyword kw">else</span>
 79:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:schema_date</span>] = <span class="ruby-value str">&quot;2005&quot;</span> <span class="ruby-comment cmt"># The Atom spec copyright date</span>
 80:       <span class="ruby-keyword kw">end</span>
 81: 
 82:       <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:xml</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">eval</span>(<span class="ruby-value str">&quot;xml&quot;</span>, <span class="ruby-identifier">block</span>.<span class="ruby-identifier">binding</span>)
 83:       <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">instruct!</span>
 84: 
 85:       <span class="ruby-identifier">entry_opts</span> = { <span class="ruby-value str">&quot;xml:lang&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:language</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;en-US&quot;</span>,
 86:                       <span class="ruby-value str">&quot;xmlns&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'http://www.w3.org/2005/Atom'</span>,
 87:                       <span class="ruby-value str">&quot;xmlns:app&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'http://www.w3.org/2007/app'</span>
 88:       }
 89:       <span class="ruby-identifier">entry_opts</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">reject!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span><span class="ruby-identifier">k</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp re">/^xml/</span>)}
 90: 
 91:       <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">entry</span>(<span class="ruby-identifier">entry_opts</span>) <span class="ruby-keyword kw">do</span>
 92:         <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">id</span>(<span class="ruby-node">&quot;tag:#{request.host},#{options[:schema_date]}:#{record.class}/#{record.id}&quot;</span>)
 93: 
 94:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:published</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">record</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:created_at</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">created_at</span>)
 95:           <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">published</span>((<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:published</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">created_at</span>).<span class="ruby-identifier">xmlschema</span>)
 96:         <span class="ruby-keyword kw">end</span>
 97: 
 98:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:updated</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">record</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:updated_at</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">updated_at</span>)
 99:           <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">updated</span>((<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:updated</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">updated_at</span>).<span class="ruby-identifier">xmlschema</span>)
100:         <span class="ruby-keyword kw">end</span>
101: 
102:         <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">link</span>(<span class="ruby-identifier">:rel</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'alternate'</span>, <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'text/html'</span>, <span class="ruby-identifier">:href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:root_url</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">polymorphic_url</span>(<span class="ruby-identifier">record</span>))
103:         <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">link</span>(<span class="ruby-identifier">:rel</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'self'</span>, <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'application/atom+xml'</span>, <span class="ruby-identifier">:href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:url</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">url</span>)
104: 
105:         <span class="ruby-keyword kw">yield</span> <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">Helpers</span><span class="ruby-operator">::</span><span class="ruby-constant">AtomFeedHelper</span><span class="ruby-operator">::</span><span class="ruby-constant">AtomFeedBuilder</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">xml</span>, <span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">options</span>)
106:       <span class="ruby-keyword kw">end</span>
107:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000004"></a><b>atom_service</b>(record, current_agent, options = {}, &amp;block)
  </div>
  <div class="description">
  <p>
Helper function for describing Atom Service documents. See RFC 5023
</p>
<p>
Default XML namespace is &#8216;<a
href="http://www.w3.org/2007/app">www.w3.org/2007/app</a>&#8217;
&#8216;atom&#8217; namespace corresponds to &#8216;<a
href="http://www.w3.org/2005/Atom">www.w3.org/2005/Atom</a>&#8217;,
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000004_source')" id="l_M000004_source">show source</a> ]</p>
  <div id="M000004_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/station/core_ext.rb, line 47</span>
47:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">atom_service</span>(<span class="ruby-identifier">record</span>, <span class="ruby-identifier">current_agent</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
48:       <span class="ruby-identifier">xml</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:xml</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">eval</span>(<span class="ruby-value str">&quot;xml&quot;</span>, <span class="ruby-identifier">block</span>.<span class="ruby-identifier">binding</span>)
49:       <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">instruct!</span>
50: 
51:       <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">service</span> <span class="ruby-value str">&quot;xmlns&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;http://www.w3.org/2007/app&quot;</span>, <span class="ruby-value str">&quot;xmlns:atom&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'http://www.w3.org/2005/Atom'</span> <span class="ruby-keyword kw">do</span>
52:       <span class="ruby-comment cmt"># Workspaces are Containers current_agent can post to:</span>
53:       <span class="ruby-identifier">record</span>.<span class="ruby-identifier">stages</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">authorize?</span>(<span class="ruby-identifier">:read</span>, <span class="ruby-identifier">:to</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_agent</span>) }.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">container</span><span class="ruby-operator">|</span>
54:         <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">workspace</span> <span class="ruby-keyword kw">do</span>
55:           <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">tag!</span>( <span class="ruby-value str">&quot;atom:title&quot;</span>, <span class="ruby-identifier">container</span>.<span class="ruby-identifier">name</span> )
56:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">authorize?</span>([ <span class="ruby-identifier">:read</span>, <span class="ruby-identifier">:Content</span> ], <span class="ruby-identifier">:to</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_agent</span>)
57:               <span class="ruby-comment cmt"># Collections are different type of Contents</span>
58:               <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">content</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">accepted_content_types</span>
59:                 <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">collection</span>(<span class="ruby-identifier">:href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">polymorphic_path</span>([ <span class="ruby-identifier">container</span>, <span class="ruby-identifier">content</span>.<span class="ruby-identifier">to_class</span>.<span class="ruby-identifier">new</span> ]) <span class="ruby-operator">+</span> <span class="ruby-value str">'.atom'</span>) <span class="ruby-keyword kw">do</span>
60:                   <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">tag!</span>(<span class="ruby-value str">&quot;atom:title&quot;</span>, <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value str">'other_in_container'</span>, <span class="ruby-identifier">:container</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">container</span>.<span class="ruby-identifier">name</span>, <span class="ruby-identifier">:scope</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">content</span>.<span class="ruby-identifier">to_class</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">underscore</span>))
61:                   <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">accept</span>(<span class="ruby-identifier">container</span>.<span class="ruby-identifier">authorize?</span>([ <span class="ruby-identifier">:create</span>, <span class="ruby-identifier">:Content</span> ], <span class="ruby-identifier">:to</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_agent</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">content</span>.<span class="ruby-identifier">to_class</span>.<span class="ruby-identifier">accepts</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>)
62:                 <span class="ruby-keyword kw">end</span>
63:               <span class="ruby-keyword kw">end</span>
64:             <span class="ruby-keyword kw">end</span>
65:           <span class="ruby-keyword kw">end</span>
66:         <span class="ruby-keyword kw">end</span>
67:       <span class="ruby-keyword kw">end</span>
68:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000002"></a><b>polymorphic_url_with_container</b>(record_or_hash_or_array, options = {})
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000002_source')" id="l_M000002_source">show source</a> ]</p>
  <div id="M000002_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/station/core_ext.rb, line 11</span>
11:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">polymorphic_url_with_container</span>(<span class="ruby-identifier">record_or_hash_or_array</span>, <span class="ruby-identifier">options</span> = {})
12:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:container</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
13:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">polymorphic_url_without_container</span>(<span class="ruby-identifier">record_or_hash_or_array</span>, <span class="ruby-identifier">options</span>)
14:       <span class="ruby-keyword kw">end</span>
15: 
16:       <span class="ruby-identifier">rha_with_container</span> =
17:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">record_or_hash_or_array</span>
18:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
19:           <span class="ruby-identifier">unshift_container</span> <span class="ruby-identifier">record_or_hash_or_array</span>.<span class="ruby-identifier">dup</span>
20:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Hash</span>
21:           <span class="ruby-identifier">record_or_hash_or_array</span>.<span class="ruby-identifier">dup</span>
22:         <span class="ruby-keyword kw">else</span>
23:           <span class="ruby-identifier">unshift_container</span> [ <span class="ruby-identifier">record_or_hash_or_array</span> ]
24:         <span class="ruby-keyword kw">end</span>
25: 
26:       <span class="ruby-identifier">polymorphic_url_without_container</span>(<span class="ruby-identifier">rha_with_container</span>, <span class="ruby-identifier">options</span>)
27:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000001"></a><b>to_class</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000001_source')" id="l_M000001_source">show source</a> ]</p>
  <div id="M000001_source" class="dyn-source">
<pre>
   <span class="ruby-comment cmt"># File lib/station/core_ext.rb, line 3</span>
3:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_class</span>
4:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">classify</span>.<span class="ruby-identifier">constantize</span>
5:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000003"></a><b>unshift_container</b>(array)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000003_source')" id="l_M000003_source">show source</a> ]</p>
  <div id="M000003_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/station/core_ext.rb, line 30</span>
30:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unshift_container</span>(<span class="ruby-identifier">array</span>)
31:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">array</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">array</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:container</span>)
32:         <span class="ruby-identifier">array</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">array</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">container</span>)
33:       <span class="ruby-keyword kw">else</span>
34:         <span class="ruby-identifier">array</span>
35:       <span class="ruby-keyword kw">end</span>
36:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>

    </body>
</html>