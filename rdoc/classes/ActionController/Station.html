<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Module: ActionController::Station</title>
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />

    <script language="JavaScript" type="text/javascript">
    // <![CDATA[

        function toggleSource( id )
        {
          var elem
          var link

          if( document.getElementById )
          {
            elem = document.getElementById( id )
            link = document.getElementById( "l_" + id )
          }
          else if ( document.all )
          {
            elem = eval( "document.all." + id )
            link = eval( "document.all.l_" + id )
          }
          else
            return false;

          if( elem.style.display == "block" )
          {
            elem.style.display = "none"
            link.innerHTML = "show source"
          }
          else
          {
            elem.style.display = "block"
            link.innerHTML = "hide source"
          }
        }

        function openCode( url )
        {
          window.open( url, "SOURCE_CODE", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=480,width=750" ).focus();
        }
      // ]]>
    </script>
  </head>

  <body>
  <table width="100%" border='0' cellpadding='0' cellspacing='0' class='banner'><tr>
  <td class="file-title"><span class="file-title-prefix">Module</span><br />ActionController::Station</td>
  <td align="right">
    <table cellspacing="0" cellpadding="2">
      <tr valign="top">
        <td>In:</td>
        <td>
<a href="../../files/lib/action_controller/station_rb.html">lib/action_controller/station.rb</a>
        </td>
      </tr>
         </table>
        </td>
        </tr>
      </table>
 <!-- banner header -->

  <div id="bodyContent">
      <div id="content">

  <div class="description"><p>
Base methods for ActionController
</p>
</div>



  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="#M000090">current_categories_domain</a></li>
  <li><a href="#M000088">current_container</a></li>
  <li><a href="#M000089">current_container!</a></li>
  <li><a href="#M000087">current_site</a></li>
  <li><a href="#M000084">deprecated_method</a></li>
  <li><a href="#M000085">model_class</a></li>
  <li><a href="#M000086">record_from_path</a></li>
  <li><a href="#M000091">set_params_from_raw_post</a></li>
  </ul>






<div class="sectiontitle">Public Class methods</div>
<div class="method">
  <div class="title">
    <a name="M000084"></a><b>deprecated_method</b>(old_method, new_method)
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000084_source')" id="l_M000084_source">show source</a> ]</p>
  <div id="M000084_source" class="dyn-source">
<pre>
   <span class="ruby-comment cmt"># File lib/action_controller/station.rb, line 7</span>
7:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">deprecated_method</span>(<span class="ruby-identifier">old_method</span>, <span class="ruby-identifier">new_method</span>)
8:         <span class="ruby-identifier">module_eval</span> <span class="ruby-value str">&quot;def \#{ old_method } *args\nlogger.debug \&quot;Station: DEPRECATION WARNING \\\\\&quot;\#{ old_method }\\\\\&quot;. Please use \\\\\&quot;\#{ new_method }\\\\\&quot; instead.\&quot;\nline = caller.select{ |l| l =~ /^\\\#{ RAILS_ROOT }/ }.first\nlogger.debug \&quot;           in: \\\#{ line }\&quot;\nsend :\#{ new_method }, *args\nend\n&quot;</span>
9:       <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Public Instance methods</div>
<div class="method">
  <div class="title">
    <a name="M000090"></a><b>current_categories_domain</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000090_source')" id="l_M000090_source">show source</a> ]</p>
  <div id="M000090_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/action_controller/station.rb, line 131</span>
131:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_categories_domain</span>
132:       <span class="ruby-identifier">record_from_path</span>(<span class="ruby-identifier">:acts_as</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:categories_domain</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">site</span>
133:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000088"></a><b>current_container</b>()
  </div>
  <div class="description">
  <p>
Find current Container using path from the request
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000088_source')" id="l_M000088_source">show source</a> ]</p>
  <div id="M000088_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/action_controller/station.rb, line 109</span>
109:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_container</span>
110:       <span class="ruby-ivar">@container</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">record_from_path</span>(<span class="ruby-identifier">:acts_as</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:container</span>)
111:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000089"></a><b>current_container!</b>()
  </div>
  <div class="description">
  <p>
Tries to find a Container suitable for this Content
</p>
<p>
Calls container to figure out from params. If unsuccesful, it tries with
site
</p>
<p>
Renders Forbidden if no Container is found
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000089_source')" id="l_M000089_source">show source</a> ]</p>
  <div id="M000089_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/action_controller/station.rb, line 122</span>
122:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_container!</span>
123:       <span class="ruby-ivar">@container</span> = <span class="ruby-identifier">container</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">site</span>
124: 
125:       <span class="ruby-identifier">render</span>(<span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;Container not present&quot;</span>, <span class="ruby-identifier">:status</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:precondition_failed</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@container</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value str">&quot;container_options&quot;</span>)
126:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000087"></a><b>current_site</b>()
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000087_source')" id="l_M000087_source">show source</a> ]</p>
  <div id="M000087_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/action_controller/station.rb, line 102</span>
102:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">current_site</span>
103:       <span class="ruby-ivar">@site</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Site</span>.<span class="ruby-identifier">current</span>
104:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000085"></a><b>model_class</b>()
  </div>
  <div class="description">
  <p>
Returns the Model Class related to this Controller
</p>
<p>
e.g. <a href="../Attachment.html">Attachment</a> for AttachmentsController
</p>
<p>
Useful for Controller inheritance
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000085_source')" id="l_M000085_source">show source</a> ]</p>
  <div id="M000085_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/action_controller/station.rb, line 60</span>
60:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">model_class</span>
61:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">model_class</span>
62:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="method">
  <div class="title">
    <a name="M000086"></a><b>record_from_path</b>(options = {})
  </div>
  <div class="description">
  <p>
Obtains a given ActiveRecord from parameters. Options:
</p>
<ul>
<li>acts_as: the ActiveRecord model must acts_as the given symbol. acts_as
=&gt; :container

</li>
</ul>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000086_source')" id="l_M000086_source">show source</a> ]</p>
  <div id="M000086_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/action_controller/station.rb, line 68</span>
 68:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">record_from_path</span>(<span class="ruby-identifier">options</span> = {})
 69:       <span class="ruby-identifier">acts_as_module</span> = <span class="ruby-node">&quot;ActiveRecord::#{ options[:acts_as].to_s.classify }&quot;</span>.<span class="ruby-identifier">constantize</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:acts_as</span>]
 70: 
 71:       <span class="ruby-identifier">candidates</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-value">-3</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'_id'</span> }
 72: 
 73:       <span class="ruby-identifier">candidates</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">candidate_key</span><span class="ruby-operator">|</span>
 74:         <span class="ruby-comment cmt"># Filter keys that correspond to classes</span>
 75:         <span class="ruby-keyword kw">begin</span>
 76:           <span class="ruby-identifier">candidate_class</span> = <span class="ruby-identifier">candidate_key</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">-4</span>].<span class="ruby-identifier">to_sym</span>.<span class="ruby-identifier">to_class</span>
 77:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">NameError</span>
 78:           <span class="ruby-keyword kw">next</span>
 79:         <span class="ruby-keyword kw">end</span>
 80: 
 81:         <span class="ruby-comment cmt"># acts_as filter</span>
 82:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:acts_as</span>]
 83:           <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">acts_as_module</span>.<span class="ruby-identifier">classes</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">candidate_class</span>)
 84:         <span class="ruby-keyword kw">end</span>
 85: 
 86:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">candidate_class</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:find</span>)
 87: 
 88:         <span class="ruby-comment cmt"># Find record</span>
 89:         <span class="ruby-keyword kw">begin</span>
 90:           <span class="ruby-identifier">record</span> = <span class="ruby-identifier">candidate_class</span>.<span class="ruby-identifier">find_with_param</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">candidate_key</span>])
 91:           <span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-node">&quot;@#{ options[:acts_as] }&quot;</span>, <span class="ruby-identifier">record</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:acts_as</span>]
 92:           <span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-node">&quot;@#{ candidate_class.to_s.underscore }&quot;</span>, <span class="ruby-identifier">record</span>)
 93:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">record</span>
 94:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">RecordNotFound</span>
 95:           <span class="ruby-keyword kw">next</span>
 96:         <span class="ruby-keyword kw">end</span>
 97:       <span class="ruby-keyword kw">end</span>
 98: 
 99:       <span class="ruby-keyword kw">nil</span>
100:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div class="sectiontitle">Protected Instance methods</div>
<div class="method">
  <div class="title">
    <a name="M000091"></a><b>set_params_from_raw_post</b>(content = controller_name.singularize.to_sym)
  </div>
  <div class="description">
  <p>
Extract request parameters when posting raw data
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000091_source')" id="l_M000091_source">show source</a> ]</p>
  <div id="M000091_source" class="dyn-source">
<pre>
     <span class="ruby-comment cmt"># File lib/action_controller/station.rb, line 140</span>
140:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_params_from_raw_post</span>(<span class="ruby-identifier">content</span> = <span class="ruby-identifier">controller_name</span>.<span class="ruby-identifier">singularize</span>.<span class="ruby-identifier">to_sym</span>)
141:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">raw_post</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">content</span>]
142: 
143:       <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-value str">&quot;HTTP_SLUG&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">controller_name</span>.<span class="ruby-identifier">singularize</span>
144:       <span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">content_type</span>
145:       
146:       <span class="ruby-identifier">file</span> = <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;media&quot;</span>)
147:       <span class="ruby-identifier">file</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">raw_post</span>
148:       (<span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">file</span>; <span class="ruby-keyword kw">self</span>; <span class="ruby-keyword kw">end</span>).<span class="ruby-identifier">class_eval</span> <span class="ruby-keyword kw">do</span>
149:         <span class="ruby-keyword kw">alias</span> <span class="ruby-identifier">local_path</span> <span class="ruby-identifier">path</span>
150:         <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:content_type</span>) { <span class="ruby-identifier">content_type</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">taint</span> }
151:         <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">:original_filename</span>) { <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">taint</span> }
152:       <span class="ruby-keyword kw">end</span>
153: 
154:       <span class="ruby-identifier">params</span>[<span class="ruby-identifier">content</span>]                  <span class="ruby-operator">||=</span> {}
155:       <span class="ruby-identifier">params</span>[<span class="ruby-identifier">content</span>][<span class="ruby-identifier">:title</span>]          <span class="ruby-operator">||=</span> <span class="ruby-identifier">filename</span>
156:       <span class="ruby-identifier">params</span>[<span class="ruby-identifier">content</span>][<span class="ruby-identifier">:media</span>]          <span class="ruby-operator">||=</span> <span class="ruby-identifier">file</span>
157:       <span class="ruby-identifier">params</span>[<span class="ruby-identifier">content</span>][<span class="ruby-identifier">:public_read</span>]    <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">true</span>
158:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>

    </body>
</html>